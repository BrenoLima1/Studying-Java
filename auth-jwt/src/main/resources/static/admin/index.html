<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Admin - Usuários</title>
  <style>
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    #pagination { margin-top: 15px; }
    button { margin: 5px; }
  </style>
</head>
<body>
  <h1>Painel de Administração</h1>

  <button id="listUsersBtn">Listar Usuários</button>

  <table id="usersTable" style="display:none;">
    <thead>
      <tr>
        <th>ID</th>
        <th>Usuário</th>
        <th>Role</th>
      </tr>
    </thead>
    <tbody id="usersTbody"></tbody>
  </table>

  <div id="pagination" style="display:none;">
    <button id="prev-btn">Anterior</button>
    <span id="page-info"></span>
    <button id="next-btn">Próxima</button>
  </div>

  <script src="admin.js"></script>
</body>
<script>
  const usersTable = document.getElementById("usersTable");
const usersTbody = document.getElementById("usersTbody");
const listUsersBtn = document.getElementById("listUsersBtn");
const paginationDiv = document.getElementById("pagination");
const pageInfo = document.getElementById("page-info");
const prevBtn = document.getElementById("prev-btn");
const nextBtn = document.getElementById("next-btn");

let currentPage = 0;
const pageSize = 5; // quantidade de usuários por página
let totalPages = 0;

function getToken() {
  return localStorage.getItem("token"); // token salvo no login
}

async function loadUsers(page = 0) {
  const token = getToken();
  try {
    const res = await fetch(`/auth/users?page=${page}&size=${pageSize}`, {
      headers: { Authorization: `Bearer ${token}` }
    });

    if (!res.ok) throw new Error("Falha ao buscar usuários");

    const data = await res.json();

    // limpa tabela
    usersTbody.innerHTML = "";

    // preenche tabela
    data.content.forEach(u => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${u.id}</td><td>${u.username}</td><td>${u.role}</td>`;
      usersTbody.appendChild(tr);
    });

    // mostra tabela e paginação
    usersTable.style.display = "table";
    paginationDiv.style.display = "block";

    // atualiza info de paginação
    currentPage = data.number;
    totalPages = data.totalPages;
    pageInfo.textContent = `Página ${currentPage + 1} de ${totalPages}`;

    // habilita/desabilita botões
    prevBtn.disabled = currentPage === 0;
    nextBtn.disabled = currentPage + 1 >= totalPages;

  } catch (err) {
    alert(err.message);
  }
}

// evento inicial
listUsersBtn.addEventListener("click", () => loadUsers(0));

// navegação
prevBtn.addEventListener("click", () => {
  if (currentPage > 0) loadUsers(currentPage - 1);
});

nextBtn.addEventListener("click", () => {
  if (currentPage + 1 < totalPages) loadUsers(currentPage + 1);
});
</script>
</html>